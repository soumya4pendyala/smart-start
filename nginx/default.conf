# Nginx server block configuration for a React application on Cloud Run.
server {
    # Cloud Run injects the PORT environment variable. Nginx will listen on this port.
    # The 'env PORT;' directive makes the PORT environment variable available to Nginx.
    listen 8080;
    #env PORT;

    # Set the root directory for serving static files.
    # This path corresponds to where the React build output is copied inside the Docker container.
    root /usr/share/nginx/html;

    # Define the default file to serve when a directory is requested.
    index index.html index.htm;  

    # Configure how Nginx handles requests.
    location / {
        # Try to serve the requested file directly.
        # If the file is not found, try to serve it as a directory.
        # If neither is found, rewrite the URL to /index.html.
        # This is crucial for single-page applications (SPAs) like React,
        # to handle client-side routing.
        try_files $uri $uri/ /index.html;
    }

    # Optional: Configure error pages.
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}
